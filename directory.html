<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<title>CREATIVE ASSET INVENTORY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="jquery/jquery-1.6.4.min.js"></script>


 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
   crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
   integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
   crossorigin=""></script>
 <script src="randomColor.min.js"></script>
 <script src="spin-js/spin.js"></script>
 <script src="spin-js/jquery.spin.js"></script>
 
   <!-- Tabletop to access Google spreadsheets - THANK YOU AMAZING HUMANS WHO CREATED THIS!! LOVE LOVE LOVE-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.js"></script>
  
 <!-- FontAaaawwwwesome -->  
  <script src="https://use.fontawesome.com/0a9a58d8dc.js"></script>  
 <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.0.1/leaflet-omnivore.min.js'></script>
 
   <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.0.8"></script>
 
 <!-- Esri Leaflet Geocoder -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.6/dist/esri-leaflet-geocoder.css">
    <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.6"></script>


<link rel="stylesheet" href="css/cai.css" />



<style>
		
</style>

</head>				
	
<body>

<div id="iconBar"><img src="sf-logo.png" width="90px" style="float:left"><img src="ct-logo.png" height="90px" style="float:left; padding-right:20px;"></div>
<div name="titlebar" >
	<div id="header">
		<h1 style="color:#fff;">CREATIVE ASSETS INVENTORY</h1>
	</div>
</div>
<div class="topnav" id="topMenu">
  <a href="survey.html">Add an Asset!</a>
  <a href="connect.html">Get Involved</a>
  <a href="directory.html">Directory</a>
  <a href="map.html">Map</a>
    <a href="index.html">About</a>
  <a href="javascript:void(0);" style="font-size:15px;" class="icon" onclick="loadMenu()">&#9776;</a>
</div>

<h1>Assets Entered So Far</h1>

<div id="assetTableHolder" style="width:100%;"></div>
<div id="spinBox" class='spinner'></div>
<script type="text/javascript">

function loadMenu() {
    var x = document.getElementById("topMenu");
    if (x.className === "topnav") {
        x.className += " responsive";
    } else {
        x.className = "topnav";
    }
}

function sortName(a,b) {
	  if (a.a_name < b.a_name)
		return -1;
	  if (a.a_name > b.a_name)
		return 1;
	  return 0;
	}

Tabletop.init({
    	key: "https://docs.google.com/spreadsheets/d/1l9w9WBksn5WEyKkZIHnnal19YjJ9Y_JN2NmxH7az-20/edit?usp=sharing",
    	callback: setupAssets,
    	simpleSheet: true,
    	debug: false
    });

				
function getAssetColor(d) {
  switch (d) {
    case 'Space or Facility (includes vacant spaces)':
      return '#4CAF50';
	case 'Creative Places -- Cultural Facilities, Natural/Urban Spaces, Potential Resources':
	        return '#4CAF50';
    case 'Cultural Industries and Businesses':
      return '#03A9F4';
    case 'Supporting Resources':
      return '#FFC107';
    case 'Business':
      return '#03A9F4';
    case 'Creative People -- Cultural Professionals and Artists':
      return '#F44336';
    case 'Cultural Institutions, Nonprofits, and Educational Organizations':
      return '#FF5722';
	case 'Community Cultural Associations':
		return '#795548';
    case 'Cultural Events and Festivals':
      return '#673AB7';
    default:
      return '#FFEDA0';
  }
  }

var spinner = new Spinner().spin(spinBox);
var assetList = [];
var assetsByCategory = {"people":[], "businesses":[], "places":[], "institutions":[], "associations":[], "events":[], "supporting":[], "other":[]};

function categorizeAsset(d) {
	switch (d.a_type) {
				case 'Cultural Industries and Businesses':
					assetsByCategory.businesses.push(d);
					break;
					case 'Supporting Resources':
					assetsByCategory.supporting.push(d);
					break;
					case 'Creative People -- Cultural Professionals and Artists':
					 assetsByCategory.people.push(d);
					break;
					case 'Cultural Institutions, Nonprofits, and Educational Organizations':
					  assetsByCategory.institutions.push(d);
					break;
					case 'Creative Places -- Cultural Facilities, Natural/Urban Spaces, Potential Resources':
					  assetsByCategory.places.push(d);
						break;
					case 'Community Cultural Associations':
						assetsByCategory.associations.push(d);
					break;
					case 'Cultural Events and Festivals':
					 assetsByCategory.events.push(d);
					break;

				default:
					 assetsByCategory.other.push(d);
					break;	
	}
}	

var converter = ["people","businesses","places","institutions","associations","events","supporting", "other"];

function displayCategory(q) {
	console.log(q);
	if (q.style.display == 'block') {
			q.style.display = 'none';
	}
	else if (q.style.display =='none') {
		q.style.display = 'block';
	}
}

function setupAssets(data) {
	assetList=[];
	$('#spinBox').show();
	for (i=0;i<=data.length-1;i++) {
		if ((data[i].subdate != '')) {
			categorizeAsset(data[i]);
			}
		}
	var q = 0;
	for (x in assetsByCategory){
		assetsByCategory[x].sort(sortName);
		var a_type = assetsByCategory[x][0].a_type;
		var categoryname = 'category' + q;
		console.log(categoryname);
		document.getElementById("assetTableHolder").innerHTML+=
			"<div class='assetCategoryTitle'>" +
			"<table class='spacer' ></table>"+
			"<h2 onClick = 'displayCategory(" + categoryname + ")'>" + 
			"<i class='fa fa-circle fa-lg' style='padding-right:10px; color:" + getAssetColor(a_type) + "'></i>" + a_type + 
			"</h2>" + 
			"<ul class = 'assetCategory' id='" + categoryname + "' style='margin-top:-10px;display:none'>" + 
			"</ul>" +
			"</div>" ;
		displayAssets(assetsByCategory[x],categoryname);
		q++;
	}
}

function cleanLink(lk) {
	var httpsFind = lk.search('https://');
	cleaned = '';
	if (httpsFind == -1) {
		var httpFind = lk.search('http://');
		if (httpFind == -1) {
			var instaHandle = lk.search('@');
			if (instaHandle != -1) {
				cleaned = 'http://www.instagram.com/' + lk.substr(0, lk.length-1);
			}
			else {
				cleaned = 'http://' + lk.trim();
			}
		}
		else cleaned = lk;
	}
	else cleaned = lk;
	return cleaned;
}


function displayAssets(k,c) {
			assetList = k;
			console.log(c);
			var linkCleaned = '';
			for (n=0; n<=assetList.length-1; n++) {
				var websitespacer = '';
				if (assetList[n].website != '') {
					linkCleaned = cleanLink(assetList[n].website);
				}
				var locationCompile;
				var siteNum;
				
				if (assetList[n].pub_add != '') {
					locationCompile = 
						"<b>" +
						"<span class='maplink' onClick='' style='line-height:2em'><i class = 'fa fa-map-marker fa-lg'></i></span>" +
						assetList[n].pub_add + 
						"</b>" + 
						"</br>";						;
					}
				else {
					locationCompile = 
						"<b>" +
						assetList[n].town +
						"</b>" + 
						"</br>";
					}	
				
				var picSetup = '';
				
				if ((assetList[n].photolink != null) && (assetList[n].photolink != '') && (assetList[n].photolink != undefined)) {
					picSetup = 
						"<div class='imgcontainer'>" + 
						"<img class = 'assetPic' src='" + assetList[n].photolink + "'>" +
						"</div>";
				}
				
				var websiteCompile = '';
				
				if ((linkCleaned != '')) {
					websiteCompile = 	"<a style='line-height:1.5em;margin-bottom:3px;' href='"+ linkCleaned +"'>" + assetList[n].website + "</a><br>";
				}
				else {websiteCompile = '';}
<!-- 				
				var facilityCompile = '';
				if ((assetList[n].artistspace != null) && (assetList[n].artistspace != undefined) || (assetList[n].artistspace != ''))  {
					facilityCompile = "<b>Space description:</b> " + assetList[n].artistspace + "<br>";
				}
				
				else if ((assetList[n].f_desc != '') && (assetList[n].f_desc != undefined) || (assetList[n].f_desc != '')) {
					facilityCompile = "<b>Space description:</b>" +	assetList[n].f_desc + "<br>";
				}
				
				else {facilityCompile = '';}
-->				
				
				var regularTitleSetup =  
				"<div class='regularTitle'>" +
				"<h4>" + assetList[n].a_name + "</h4>" +
				locationCompile +
				websiteCompile +
				"</div>";
				
				var mobileTitleSetup =  
				"<div class='mobileTitle'>" +
				"<h4>" + assetList[n].a_name + "</h4>" +
				locationCompile +
				websiteCompile +
				"</div>";

				var info = 	
				mobileTitleSetup +	
				picSetup +				
				regularTitleSetup +
				"<div class='assetDesc'>" +
				assetList[n].a_desc + "<br><br>" +
//				facilityCompile +
				"</div>" ;
				
				assetContainerID = n.toString();
				
				document.getElementById(c).innerHTML +=
				"<div class='artPod'>" +
				"<table id='"+ assetContainerID + "'>" + 
				info +
				"</table>" + 
				"<table class='spacer'></table>"+
				"</div>" ;
			}
	
		$('#spinBox').hide();
	
}



		
			
			

			

	
</script> 
  

</body>
</html>